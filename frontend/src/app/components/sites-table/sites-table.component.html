<div class="container mt-4">
    <h3>Site Management</h3>

    <!-- Excel import -->
    <div class="mb-3">
        <label class="form-label">Import Sites from Excel</label>
        <input type="file" class="form-control mb-2" accept=".xlsx,.xls" (change)="onFileSelected($event)">
        <button class="btn btn-primary" [disabled]="!selectedFile" (click)="importExcel()">Import</button>
    </div>
    <h5>Filters</h5>
    <!-- Filters -->
    <div class="mb-3">
        <button class="btn btn-sm btn-primary me-2" (click)="applyFilter('lat_gt_40')">Lat ≥ 40</button>
        <button class="btn btn-sm btn-secondary me-2" (click)="applyFilter('lat_lt_40')">Lat < 40</button>
        <button class="btn btn-sm btn-info me-2" (click)="applyFilter('lon_gt_40')">Lon ≥ 40</button>
        <button class="btn btn-sm btn-warning me-2" (click)="applyFilter('lon_lt_40')">Lon < 40</button>
        <button class="btn btn-sm btn-dark" (click)="applyFilter('reset')">Reset</button>
    </div>
    <h5>Data</h5>
    <!-- Sites table -->
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th (click)="toggleSort('sitename')" style="cursor:pointer">
                    Site Name
                    <span *ngIf="sortBy === 'sitename'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span>
                  </th>
                  <th (click)="toggleSort('sitenumber')" style="cursor:pointer">
                    Site Number
                    <span *ngIf="sortBy === 'sitenumber'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span>
                  </th>
                  <th (click)="toggleSort('lat')" style="cursor:pointer">
                    Latitude
                    <span *ngIf="sortBy === 'lat'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span>
                  </th>
                  <th (click)="toggleSort('lon')" style="cursor:pointer">
                    Longitude
                    <span *ngIf="sortBy === 'lon'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span>
                  </th>
                  <th (click)="toggleSort('area')" style="cursor:pointer">
                    Area
                    <span *ngIf="sortBy === 'area'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span>
                  </th>
                  <th (click)="toggleSort('installation_date')" style="cursor:pointer">
                    Installation Date
                    <span *ngIf="sortBy === 'installation_date'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span>
                  </th>
                  <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let site of sites">

                <!-- Edit mode for Site Name -->
                <td *ngIf="selectedSite?.sitenumber === site.sitenumber">
                    <input type="text" *ngIf="selectedSite" class="form-control" [(ngModel)]="selectedSite.sitename">
                </td>
                <td *ngIf="selectedSite?.sitenumber !== site.sitenumber">{{site.sitename}}</td>

                <!-- Edit mode for Site Number -->
                <td>{{site.sitenumber}}</td>

                <!-- Edit mode for Latitude -->
                <td *ngIf="selectedSite?.sitenumber === site.sitenumber">
                    <input type="number" *ngIf="selectedSite" step="any" class="form-control"
                        [(ngModel)]="selectedSite.lat">
                </td>
                <td *ngIf="selectedSite?.sitenumber !== site.sitenumber">{{site.lat}}</td>

                <!-- Edit mode for Longitude -->
                <td *ngIf="selectedSite?.sitenumber === site.sitenumber">
                    <input type="number" *ngIf="selectedSite" step="any" class="form-control"
                        [(ngModel)]="selectedSite.lon">
                </td>
                <td *ngIf="selectedSite?.sitenumber !== site.sitenumber">{{site.lon}}</td>

                <!-- Edit mode for Area -->
                <td *ngIf="selectedSite?.sitenumber === site.sitenumber">
                    <input type="text" *ngIf="selectedSite" class="form-control" [(ngModel)]="selectedSite.area">
                </td>
                <td *ngIf="selectedSite?.sitenumber !== site.sitenumber">{{site.area}}</td>

                <!-- Edit mode for Installation Date -->
                <td *ngIf="selectedSite?.sitenumber === site.sitenumber">
                    <input type="date" *ngIf="selectedSite" class="form-control"
                        [(ngModel)]="selectedSite.installation_date">
                </td>
                <td *ngIf="selectedSite?.sitenumber !== site.sitenumber">{{site.installation_date}}</td>

                <!-- Actions -->
                <td>
                    <button class="btn btn-sm me-1"
                        [ngClass]="{'btn-secondary': selectedSite?.sitenumber === site.sitenumber, 'btn-primary': selectedSite?.sitenumber !== site.sitenumber }"
                        (click)="toggleEdit(site)">{{ selectedSite?.sitenumber === site.sitenumber ? 'Cancel' :
                        'Edit'}}</button>
                    <button *ngIf="selectedSite?.sitenumber === site.sitenumber" class="btn btn-success btn-sm me-1"
                        (click)="saveSite()">Save</button>
                    <button class="btn btn-danger btn-sm" *ngIf="selectedSite?.sitenumber !== site.sitenumber"
                        (click)="deleteSite(site.sitenumber)">Delete</button>
                </td>
            </tr>
        </tbody>
    </table>
    <!-- Paginator -->
    <nav *ngIf="pagination && pagination.last_page > 1" aria-label="Site pagination">
        <ul class="pagination justify-content-center">
            <!-- Previous -->
            <li class="page-item" [class.disabled]="pagination.current_page === 1">
                <a class="page-link" href="#" (click)="changePage(pagination.current_page - 1, $event)">Previous</a>
            </li>

            <!-- Page numbers -->
            <li *ngFor="let page of [].constructor(pagination.last_page); let i = index" class="page-item"
                [class.active]="pagination.current_page === i + 1">
                <a class="page-link" href="#" (click)="changePage(i + 1, $event)">{{ i + 1 }}</a>
            </li>

            <!-- Next -->
            <li class="page-item" [class.disabled]="pagination.current_page === pagination.last_page">
                <a class="page-link" href="#" (click)="changePage(pagination.current_page + 1, $event)">Next</a>
            </li>
        </ul>
    </nav>
</div>